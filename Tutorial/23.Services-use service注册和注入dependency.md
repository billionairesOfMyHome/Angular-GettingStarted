# register注册 services with Angular injector

根据 service 的使用范围，可以向 root application injector 注册，也可以向 component 注册。

In addition to the root application injector, Angular has an injector for each component, mirroring the component tree.

## register with root application injector

向 root application injector 注册的 service，整个 Application 的 component 和 service 都能用

A service registered with the root application injector is available to any component or other service in the application. 

<img src="imgs\services10.png" style="zoom:50%;" />

在 service 中，将 providedIn property 添加到 Injectable decorator 中，值为 root。然后，ProductService 的 instance 就可以在 application 中的任何位置注入 

Here in the service, we add the providedIn property to the Injectable decorator and set it to root. An instance of the ProductService is then available for injection anywhere in the application

<img src="imgs\services13.png" style="zoom:50%;" />

在 Angular 6 之前的版本，service 定义在 module 中，6 之后的最佳实际不定义在 module 中，而是 register with Angular 向 Angular injector 注册。

这提供了更好的 tree shaking。tree shaking 是 Angular 编译器为生成更小的部署的 bundles 而 shake out 未使用代码的过程。

This provides better tree shaking. Tree shaking is a process whereby the Angular compiler shakes out unused code for smaller deployed bundles

<img src="imgs\services15.png" style="zoom:50%;" />

## register with component providers

向 component 注册的 service，只有当前 component 和 nested/child component 能用

A service registered with a specific component is only available to that component and its child or nested components.

<img src="imgs\services11.png" style="zoom:50%;" />

这将隔离 service，使其仅由一个 component 及 children 使用的，并为不同的 component instances 提供不同的 service instances，也就是 service 就不是单例的了

This isolates(孤立) a service that is used by only one component and its children, and it provides multiple instances of the service for multiple instances of the component. 

<img src="imgs\services12.png" style="zoom:50%;" />

<img src="imgs\services14.png" style="zoom:50%;" />

# inject注入 services

在 TypeScript 中，构造器是用构造函数定义的。每个 class 都有一个构造函数，构造函数在 create class instance时执行。如果没有显式的构造函数，则隐式构造函数会被调用。如果我们想注入依赖项，例如 an instance of a service，则需要显式的构造函数。

In TypeScript, a constructor is defined with a constructor function. Every class has a constructor that is executed when an instance of the class is created. If there is no explicit constructor defined for the class, an implicit constructor is used. But if we want to inject dependencies such as an instance of a service, we need an explicit constructor.

构造函数在 create the component 时执行，它主要用于 initialization，所以执行的代码越少越好，一些具有 side effects 和耗时的代码不要放 constructor 中。

The constructor function is executed when the component is created, it is primarily used for initialization and not for code that has side effects or takes time to execute. 

Angular injector 给 constructor 注入了 service instance 的 component 提供 instance 

the injector provides the service instance to any component that injects it using the constructor. 

<img src="imgs\services9.png" style="zoom:50%;" />

# 小结

## registering services

<img src="C:\Learning\Angular\Angular-GettingStarted\Tutorial\imgs\services889.png" style="zoom:50%;" />

## dependency injection

<img src="imgs\services900.png" style="zoom:50%;" />
